openapi: 3.0.3
info:
  title: Podoskin Solution API
  description: |
    API REST para sistema integral de gestión clínica para podología.
    
    ## Características
    - Gestión completa de pacientes y expedientes médicos
    - Sistema de citas con verificación de disponibilidad
    - Registro de signos vitales con cálculo automático de IMC
    - Diagnósticos con códigos CIE-10
    - Autenticación mediante JWT
    
    ## Autenticación
    La API utiliza tokens JWT (JSON Web Tokens) para autenticación.
    Incluir el token en el header `Authorization: Bearer {token}` en todas las peticiones protegidas.
    
  version: 1.0.0
  contact:
    name: Podoskin Development Team
    email: dev@podoskin.com
  license:
    name: Proprietary

servers:
  - url: http://localhost:8000/api/v1
    description: Servidor de desarrollo local
  - url: https://api.podoskin.com/v1
    description: Servidor de producción

tags:
  - name: Autenticación
    description: Endpoints para autenticación y gestión de tokens
  - name: Pacientes
    description: Gestión de pacientes y datos personales
  - name: Alergias
    description: Gestión de alergias de pacientes
  - name: Citas
    description: Sistema de agendamiento y gestión de citas
  - name: Signos Vitales
    description: Registro y consulta de signos vitales
  - name: Diagnósticos
    description: Registro y consulta de diagnósticos médicos

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtenido del endpoint /auth/login

  schemas:
    Error:
      type: object
      properties:
        detail:
          type: string
          description: Descripción del error
          example: "No se encontró el recurso solicitado"
      required:
        - detail

    ValidationError:
      type: object
      properties:
        detail:
          type: array
          items:
            type: object
            properties:
              loc:
                type: array
                items:
                  type: string
              msg:
                type: string
              type:
                type: string

    LoginRequest:
      type: object
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 50
          pattern: '^[a-zA-Z0-9_.]+$'
          example: "dr.santiago"
        password:
          type: string
          minLength: 8
          maxLength: 100
          format: password
          example: "SecurePass123!"
      required:
        - username
        - password

    LoginResponse:
      type: object
      properties:
        access_token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        token_type:
          type: string
          example: "bearer"
        expires_in:
          type: integer
          example: 3600
        user:
          $ref: '#/components/schemas/User'
      required:
        - access_token
        - token_type
        - expires_in
        - user

    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        username:
          type: string
          example: "dr.santiago"
        email:
          type: string
          format: email
          example: "santiago@podoskin.com"
        rol:
          type: string
          enum: [podologo, administrador, recepcionista]
          example: "podologo"
        nombre_completo:
          type: string
          example: "Dr. Santiago Ornelas"

    PacienteCreate:
      type: object
      properties:
        primer_nombre:
          type: string
          minLength: 1
          maxLength: 50
          example: "Juan"
        segundo_nombre:
          type: string
          maxLength: 50
          example: "Carlos"
        primer_apellido:
          type: string
          minLength: 1
          maxLength: 50
          example: "Pérez"
        segundo_apellido:
          type: string
          maxLength: 50
          example: "García"
        fecha_nacimiento:
          type: string
          format: date
          example: "1990-05-15"
        sexo:
          type: string
          enum: [M, F]
          example: "M"
        telefono_principal:
          type: string
          pattern: '^\d{10}$'
          example: "6861234567"
        telefono_secundario:
          type: string
          pattern: '^\d{10}$'
          example: "6869876543"
        email:
          type: string
          format: email
          example: "juan.perez@email.com"
        curp:
          type: string
          pattern: '^[A-Z]{4}\d{6}[HM][A-Z]{5}\d{2}$'
          example: "PEGJ900515HDFRRN01"
        tipo_sangre:
          type: string
          enum: ["O+", "O-", "A+", "A-", "B+", "B-", "AB+", "AB-"]
          example: "O+"
        estado_civil:
          type: string
          enum: [Soltero, Casado, Divorciado, Viudo, Union_Libre]
          example: "Soltero"
        ocupacion:
          type: string
          maxLength: 100
          example: "Ingeniero"
        activo:
          type: boolean
          default: true
      required:
        - primer_nombre
        - primer_apellido
        - fecha_nacimiento
        - sexo
        - telefono_principal

    Paciente:
      allOf:
        - $ref: '#/components/schemas/PacienteCreate'
        - type: object
          properties:
            id:
              type: integer
              example: 1
            nombre_completo:
              type: string
              example: "Juan Carlos Pérez García"
            edad:
              type: integer
              example: 34
            ultima_cita:
              type: string
              format: date-time
              nullable: true
              example: "2024-12-20T10:00:00"
            total_citas:
              type: integer
              example: 5
            fecha_registro:
              type: string
              format: date-time
              example: "2024-01-15T09:30:00"
          required:
            - id
            - nombre_completo
            - edad

    PacienteList:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Paciente'
        total:
          type: integer
          example: 150
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 20
        total_pages:
          type: integer
          example: 8

    AlergiaCreate:
      type: object
      properties:
        tipo:
          type: string
          enum: [Medicamento, Alimento, Ambiental, Material, Otro]
          example: "Medicamento"
        nombre:
          type: string
          minLength: 1
          maxLength: 100
          example: "Penicilina"
        reaccion:
          type: string
          maxLength: 200
          example: "Rash cutáneo"
        severidad:
          type: string
          enum: [Leve, Moderada, Severa]
          example: "Moderada"
        fecha_diagnostico:
          type: string
          format: date
          example: "2020-03-15"
        activo:
          type: boolean
          default: true
      required:
        - tipo
        - nombre
        - severidad

    Alergia:
      allOf:
        - $ref: '#/components/schemas/AlergiaCreate'
        - type: object
          properties:
            id:
              type: integer
              example: 1
            id_paciente:
              type: integer
              example: 42
          required:
            - id
            - id_paciente

    AlergiaList:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Alergia'
        total:
          type: integer
          example: 2

    DisponibilidadSlot:
      type: object
      properties:
        hora:
          type: string
          pattern: '^\d{2}:\d{2}$'
          example: "10:00"
        disponible:
          type: boolean
          example: true
        motivo:
          type: string
          example: "Cita agendada"

    Disponibilidad:
      type: object
      properties:
        fecha:
          type: string
          format: date
          example: "2024-12-26"
        podologo:
          type: object
          properties:
            id:
              type: integer
              example: 1
            nombre:
              type: string
              example: "Dr. Santiago Ornelas"
        slots:
          type: array
          items:
            $ref: '#/components/schemas/DisponibilidadSlot'

    CitaCreate:
      type: object
      properties:
        id_paciente:
          type: integer
          example: 42
        id_podologo:
          type: integer
          example: 1
        fecha_hora_inicio:
          type: string
          format: date-time
          example: "2024-12-26T10:00:00"
        tipo_cita:
          type: string
          enum: [Consulta, Seguimiento, Urgencia]
          example: "Consulta"
        motivo_consulta:
          type: string
          maxLength: 500
          example: "Dolor en pie derecho"
        notas_recepcion:
          type: string
          maxLength: 500
          example: "Primera vez"
      required:
        - id_paciente
        - id_podologo
        - fecha_hora_inicio
        - tipo_cita

    Cita:
      allOf:
        - $ref: '#/components/schemas/CitaCreate'
        - type: object
          properties:
            id:
              type: integer
              example: 123
            fecha_hora_fin:
              type: string
              format: date-time
              example: "2024-12-26T10:30:00"
            estado:
              type: string
              enum: [Confirmada, Completada, Cancelada, No_Asistio]
              example: "Confirmada"
            es_primera_vez:
              type: boolean
              example: true
            recordatorio_24h_enviado:
              type: boolean
              example: false
            recordatorio_2h_enviado:
              type: boolean
              example: false
            paciente:
              type: object
              properties:
                id:
                  type: integer
                nombre_completo:
                  type: string
              example:
                id: 42
                nombre_completo: "Juan Pérez"
          required:
            - id
            - fecha_hora_fin
            - estado
            - es_primera_vez

    CitaList:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Cita'
        total:
          type: integer
        page:
          type: integer
        limit:
          type: integer
        total_pages:
          type: integer

    SignosVitalesCreate:
      type: object
      properties:
        peso_kg:
          type: number
          format: float
          minimum: 0.1
          maximum: 500
          example: 75.5
        talla_cm:
          type: number
          format: float
          minimum: 30
          maximum: 250
          example: 170
        presion_sistolica:
          type: integer
          minimum: 60
          maximum: 250
          example: 120
        presion_diastolica:
          type: integer
          minimum: 40
          maximum: 150
          example: 80
        frecuencia_cardiaca:
          type: integer
          minimum: 30
          maximum: 200
          example: 72
        frecuencia_respiratoria:
          type: integer
          minimum: 8
          maximum: 60
          example: 16
        temperatura_celsius:
          type: number
          format: float
          minimum: 34
          maximum: 42
          example: 36.5
        saturacion_oxigeno:
          type: integer
          minimum: 70
          maximum: 100
          example: 98
        glucosa_capilar:
          type: integer
          minimum: 30
          maximum: 600
          example: 95

    SignosVitales:
      allOf:
        - $ref: '#/components/schemas/SignosVitalesCreate'
        - type: object
          properties:
            id:
              type: integer
              example: 1
            id_cita:
              type: integer
              example: 123
            imc:
              type: number
              format: float
              example: 26.12
            imc_clasificacion:
              type: string
              enum: [Bajo peso, Normal, Sobrepeso, Obesidad]
              example: "Sobrepeso"
            presion_arterial:
              type: string
              example: "120/80"
            fecha_medicion:
              type: string
              format: date-time
              example: "2024-12-26T10:05:00"
          required:
            - id
            - id_cita
            - fecha_medicion

    DiagnosticoCreate:
      type: object
      properties:
        tipo:
          type: string
          enum: [Presuntivo, Definitivo, Diferencial]
          example: "Definitivo"
        descripcion:
          type: string
          minLength: 1
          maxLength: 500
          example: "Fascitis plantar bilateral"
        codigo_cie10:
          type: string
          pattern: '^[A-Z]\d{2}(\.\d{1,2})?$'
          example: "M72.2"
        notas:
          type: string
          maxLength: 1000
          example: "Tratamiento recomendado: fisioterapia"
      required:
        - tipo
        - descripcion

    Diagnostico:
      allOf:
        - $ref: '#/components/schemas/DiagnosticoCreate'
        - type: object
          properties:
            id:
              type: integer
              example: 1
            id_cita:
              type: integer
              example: 123
            codigo_cie10_descripcion:
              type: string
              example: "Fibromatosis de la aponeurosis plantar"
            diagnosticado_por:
              type: object
              properties:
                id:
                  type: integer
                nombre:
                  type: string
              example:
                id: 1
                nombre: "Dr. Santiago Ornelas"
            fecha_diagnostico:
              type: string
              format: date-time
              example: "2024-12-26T10:15:00"
          required:
            - id
            - id_cita
            - diagnosticado_por
            - fecha_diagnostico

    DiagnosticoList:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Diagnostico'
        total:
          type: integer

paths:
  /auth/login:
    post:
      tags:
        - Autenticación
      summary: Iniciar sesión
      description: Autentica un usuario y retorna un token JWT
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login exitoso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Credenciales inválidas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '422':
          description: Error de validación
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

  /pacientes:
    get:
      tags:
        - Pacientes
      summary: Listar pacientes
      description: Obtiene lista paginada de pacientes con filtros opcionales
      operationId: getPacientes
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: search
          in: query
          description: Búsqueda por nombre o teléfono
          schema:
            type: string
        - name: activo
          in: query
          schema:
            type: boolean
            default: true
        - name: orden
          in: query
          schema:
            type: string
            enum: [nombre, fecha_registro, ultima_cita]
            default: nombre
        - name: direccion
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: asc
      responses:
        '200':
          description: Lista de pacientes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PacienteList'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags:
        - Pacientes
      summary: Crear paciente
      description: Crea un nuevo paciente en el sistema
      operationId: createPaciente
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PacienteCreate'
      responses:
        '201':
          description: Paciente creado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Paciente'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'

  /pacientes/{id}:
    get:
      tags:
        - Pacientes
      summary: Obtener paciente
      description: Obtiene detalles de un paciente específico
      operationId: getPaciente
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PacienteId'
      responses:
        '200':
          description: Detalles del paciente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Paciente'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags:
        - Pacientes
      summary: Actualizar paciente
      description: Actualiza datos de un paciente existente
      operationId: updatePaciente
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PacienteId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PacienteCreate'
      responses:
        '200':
          description: Paciente actualizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Paciente'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'

    delete:
      tags:
        - Pacientes
      summary: Eliminar paciente (soft delete)
      description: Marca un paciente como inactivo
      operationId: deletePaciente
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PacienteId'
      responses:
        '200':
          description: Paciente marcado como inactivo
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Paciente'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /pacientes/{id}/alergias:
    get:
      tags:
        - Alergias
      summary: Listar alergias
      description: Obtiene lista de alergias de un paciente
      operationId: getAlergias
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PacienteId'
      responses:
        '200':
          description: Lista de alergias
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlergiaList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags:
        - Alergias
      summary: Agregar alergia
      description: Agrega una nueva alergia a un paciente
      operationId: createAlergia
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PacienteId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AlergiaCreate'
      responses:
        '201':
          description: Alergia creada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Alergia'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'

  /citas/disponibilidad:
    get:
      tags:
        - Citas
      summary: Verificar disponibilidad
      description: Consulta slots disponibles para agendar citas
      operationId: getDisponibilidad
      security:
        - BearerAuth: []
      parameters:
        - name: id_podologo
          in: query
          required: true
          schema:
            type: integer
        - name: fecha
          in: query
          required: true
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Disponibilidad consultada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Disponibilidad'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'

  /citas:
    get:
      tags:
        - Citas
      summary: Listar citas
      description: Obtiene lista de citas con filtros opcionales
      operationId: getCitas
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: fecha
          in: query
          schema:
            type: string
            format: date
        - name: id_paciente
          in: query
          schema:
            type: integer
        - name: id_podologo
          in: query
          schema:
            type: integer
        - name: estado
          in: query
          schema:
            type: string
            enum: [Confirmada, Completada, Cancelada, No_Asistio]
      responses:
        '200':
          description: Lista de citas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CitaList'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags:
        - Citas
      summary: Crear cita
      description: Agenda una nueva cita
      operationId: createCita
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CitaCreate'
      responses:
        '201':
          description: Cita creada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cita'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Conflicto de horario
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '422':
          $ref: '#/components/responses/ValidationError'

  /citas/{id}:
    put:
      tags:
        - Citas
      summary: Actualizar cita
      description: Actualiza datos de una cita existente
      operationId: updateCita
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/CitaId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                estado:
                  type: string
                  enum: [Confirmada, Completada, Cancelada, No_Asistio]
                notas_recepcion:
                  type: string
      responses:
        '200':
          description: Cita actualizada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cita'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'

    delete:
      tags:
        - Citas
      summary: Cancelar cita
      description: Cancela una cita existente
      operationId: cancelCita
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/CitaId'
      responses:
        '200':
          description: Cita cancelada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cita'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: No se puede cancelar cita completada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /citas/{id}/signos-vitales:
    post:
      tags:
        - Signos Vitales
      summary: Registrar signos vitales
      description: Registra signos vitales para una cita. Calcula automáticamente el IMC si se proporcionan peso y talla
      operationId: createSignosVitales
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/CitaId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignosVitalesCreate'
      responses:
        '201':
          description: Signos vitales registrados
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignosVitales'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'

  /citas/{id}/diagnosticos:
    get:
      tags:
        - Diagnósticos
      summary: Listar diagnósticos
      description: Obtiene lista de diagnósticos de una cita
      operationId: getDiagnosticos
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/CitaId'
      responses:
        '200':
          description: Lista de diagnósticos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DiagnosticoList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags:
        - Diagnósticos
      summary: Registrar diagnóstico
      description: Registra un diagnóstico para una cita
      operationId: createDiagnostico
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/CitaId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DiagnosticoCreate'
      responses:
        '201':
          description: Diagnóstico registrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Diagnostico'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'

  components:
    parameters:
      PacienteId:
        name: id
        in: path
        required: true
        description: ID del paciente
        schema:
          type: integer
          example: 42

      CitaId:
        name: id
        in: path
        required: true
        description: ID de la cita
        schema:
          type: integer
          example: 123

    responses:
      Unauthorized:
        description: No autorizado - Token inválido o ausente
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'

      NotFound:
        description: Recurso no encontrado
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'

      ValidationError:
        description: Error de validación
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidationError'
